<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Store - Ù…ØªØ¬Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <style>
        :root {
            --primary-color: #00d2ff;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: 30px;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s;
            border: 1px solid #334155;
        }

        .card:hover {
            transform: translateY(-10px);
            border-color: var(--primary-color);
        }

        .card img {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .card h3 { margin: 10px 0; color: var(--primary-color); }
        .card p { font-size: 0.9em; color: #94a3b8; height: 40px; }
        .card .price { font-size: 1.5em; font-weight: bold; margin: 15px 0; color: #10b981; }

        .btn-buy {
            background-color: var(--primary-color);
            color: #000;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-buy:hover { opacity: 0.9; }
    </style>
</head>
<body>

<header>
    <h1>Market Store ğŸ›’</h1>
    <p>Ø£ÙØ¶Ù„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
</header>

<div class="container">
    <div class="card">
        <h3>Free Fire - 100 Diamonds</h3>
        <p>Ø´Ø­Ù† ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù€ ID Ø§Ù„Ø±Ø³Ù…ÙŠ</p>
        <div class="price">300 Ø¯Ø¬</div>
        <a href="https://wa.me/213777392155?text=Ø£Ø±ÙŠØ¯_Ø´Ø­Ù†_100_Ø¬ÙˆÙ‡Ø±Ø©_ÙØ±ÙŠ_ÙØ§ÙŠØ±" class="btn-buy">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</a>
    </div>

    <div class="card">
        <h3>Netflix Premium</h3>
        <p>Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø± ÙƒØ§Ù…Ù„ - Ø¬ÙˆØ¯Ø© 4K Ultra HD</p>
        <div class="price">3100 Ø¯Ø¬</div>
        <a href="https://wa.me/213777392155?text=Ø£Ø±ÙŠØ¯_Ø·Ù„Ø¨_Ù†ÙŠØªÙÙ„ÙŠÙƒØ³_Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…" class="btn-buy">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</a>
    </div>

    <div class="card">
        <h3>eFootball - 1040 Coins</h3>
        <p>Ø´Ø­Ù† ÙƒÙˆÙŠÙ†Ø² Ø¥ÙŠ ÙÙˆØªØ¨ÙˆÙ„ 26 (Ø§Ù„Ù‡Ø§ØªÙ)</p>
        <div class="price">1500 Ø¯Ø¬</div>
        <a href="https://wa.me/213777392155?text=Ø£Ø±ÙŠØ¯_ÙƒÙˆÙŠÙ†Ø²_Ø¥ÙŠ_ÙÙˆØªØ¨ÙˆÙ„" class="btn-buy">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</a>
    </div>

    <div class="card">
        <h3>Monthly Membership FF</h3>
        <p>Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© - Ø£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¬ÙˆØ§Ù‡Ø±</p>
        <div class="price">2850 Ø¯Ø¬</div>
        <a href="https://wa.me/213777392155?text=Ø£Ø±ÙŠØ¯_Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©_Ø§Ù„Ø´Ù‡Ø±ÙŠØ©_ÙØ±ÙŠ_ÙØ§ÙŠØ±" class="btn-buy">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</a>
    </div>
</div>
<div id="orderModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; padding:20px; box-sizing:border-box;">
    <div style="background:#151921; width:100%; max-width:400px; margin:50px auto; padding:25px; border-radius:20px; border:1px solid #00d4ff; text-align:right;">
        <h3 id="modalTitle" style="color:#00d4ff; margin-top:0;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h3>
        <p id="modalPrice" style="color:#00d4ff; font-weight:bold; font-size:1.2rem;"></p>
        
        <div id="inputContainer">
            <label style="display:block; margin-bottom:5px; font-size:14px;">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø¬ÙŠÙ…ÙŠÙ„ + Ø¨Ø§Ø³ÙˆØ±Ø¯ / ID):</label>
            <textarea id="accountDetails" rows="3" style="width:100%; padding:10px; border-radius:8px; background:#0b0e14; color:white; border:1px solid #2d343f; resize:none;" placeholder="Ù…Ø«Ø§Ù„: shuaib@gmail.com | Pass: 123456"></textarea>
        </div>

        <div style="margin-top:15px;">
            <label style="display:block; margin-bottom:5px; font-size:14px;">ØµÙˆØ±Ø© ÙˆØµÙ„ Ø§Ù„Ø¯ÙØ¹ (CCP/BaridiMob):</label>
            <input type="file" id="receiptFile" accept="image/*" style="width:100%; font-size:13px; color:#888;">
        </div>
        
        <button class="btn-order" id="confirmBtn" onclick="submitFinalOrder()" style="margin-top:20px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ÙˆØµÙ„ âœ…</button>
        <button onclick="closeModal()" style="background:none; color:#ff4757; border:none; margin-top:15px; cursor:pointer; width:100%; font-weight:bold;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
</div>

<script type="module">
    // ... (Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø§Øª) ...
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    const storage = getStorage(app);
    let currentItem = "";
    let currentPrice = "";

    window.processOrder = (selectId, category) => {
        const val = document.getElementById(selectId).value;
        [currentItem, currentPrice] = val.split(" - ");
        
        document.getElementById('modalTitle').innerText = category + " - " + currentItem;
        document.getElementById('modalPrice').innerText = currentPrice;
        
        // ØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ (Placeholder) Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬
        const detailInput = document.getElementById('accountDetails');
        if (category.includes("eFootball") || category.includes("Gemini") || category.includes("Netflix")) {
            detailInput.placeholder = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¬ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (Konami ID / Account)";
        } else {
            detailInput.placeholder = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù„Ø§Ø¹Ø¨";
        }
        
        document.getElementById('orderModal').style.display = 'block';
    };

    window.closeModal = () => {
        document.getElementById('orderModal').style.display = 'none';
        document.getElementById('receiptFile').value = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ù…Ù„Ù
    };

    window.submitFinalOrder = async () => {
        const details = document.getElementById('accountDetails').value;
        const file = document.getElementById('receiptFile').files[0];
        const user = auth.currentUser;

        if (!details || !file) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„!");

        try {
            document.getElementById('confirmBtn').innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ÙˆØµÙ„ ÙˆØ§Ù„Ø¥Ø±Ø³Ø§Ù„...";
            document.getElementById('confirmBtn').disabled = true;
            
            // 1. Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„ Ø¥Ù„Ù‰ Firebase Storage
            const storageRef = ref(storage, 'receipts/' + Date.now() + "_" + user.uid);
            const snapshot = await uploadBytes(storageRef, file);
            const receiptURL = await getDownloadURL(snapshot.ref);

            // 2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ ÙÙŠ Firestore
            await addDoc(collection(db, "orders"), {
                customerName: user.displayName,
                customerEmail: user.email,
                product: currentItem,
                price: currentPrice,
                accountData: details, // (Ø§Ù„Ø¬ÙŠÙ…ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø£Ùˆ Ø§Ù„Ù€ ID)
                receiptImg: receiptURL, // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
                status: "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
                time: serverTimestamp()
            });

            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙˆØ± Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆØµÙ„.");
            closeModal();
            document.getElementById('confirmBtn').innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ÙˆØµÙ„ âœ…";
            document.getElementById('confirmBtn').disabled = false;
        } catch (e) {
            console.error(e);
            alert("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Storage ÙÙŠ Firebase ÙˆÙˆØ¶Ø¹ Rules Ø¹Ù„Ù‰ True");
            document.getElementById('confirmBtn').disabled = false;
        }
    };
        </script>
    // Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ù…Ù„Ù index.html Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø²Ø¨ÙˆÙ†
onSnapshot(collection(db, "orders"), (snapshot) => {
    snapshot.forEach((doc) => {
        const data = doc.data();
        if (data.customerEmail === auth.currentUser.email && data.status === "ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…") {
            alert("ğŸ‰ Ø¨Ø´Ø±Ù‰ Ø³Ø§Ø±Ø©! ØªÙ… ØªØ³Ù„ÙŠÙ… Ø·Ù„Ø¨Ùƒ Ù„Ù€ " + data.product);
        }
    });
});
// Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡ ØµÙˆØªÙŠ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
const audio = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');

onSnapshot(collection(db, "orders"), (snapshot) => {
    snapshot.docChanges().forEach((change) => {
        if (change.type === "added") {
            audio.play(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ø±Ø³
            console.log("Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØ§ØµÙ„!");
        }
    });
    // ... Ø¨Ù‚ÙŠØ© ÙƒÙˆØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ...
});
    
</body>
</html>
