<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Market Store</title>
    <style>
        :root { --main: #00d2ff; --bg: #0f172a; --card: #1e293b; --text: #ffffff; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        /* Ø¥Ø®ÙØ§Ø¡ ØªØ§Ù… Ù„ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .page { display: none; padding: 20px; box-sizing: border-box; }
        .active { display: block !important; }

        .header { background: var(--card); padding: 15px; border-bottom: 2px solid var(--main); text-align: center; font-weight: bold; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .card { background: var(--card); border-radius: 12px; padding: 10px; text-align: center; border: 1px solid #334155; }
        
        input { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn { background: var(--main); color: #000; width: 100%; padding: 12px; border-radius: 25px; border: none; font-weight: bold; margin-top: 15px; cursor: pointer; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø®Ø§Ù†Ø© Ø§Ù„ÙˆØµÙ„ */
        .upload-section { background: #1e293b; padding: 10px; border-radius: 10px; margin-top: 15px; border: 1px dashed var(--main); text-align: right; }
        footer { padding: 20px; text-align: center; font-size: 0.7rem; color: #94a3b8; }
    </style>
</head>
<body>

<div id="loginP" class="page active">
    <div style="text-align: center; padding-top: 50px;">
        <h1 style="color: var(--main);">Market Store</h1>
        <p>Ø³Ø¬Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
        <input type="text" id="uName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <button type="button" class="btn" onclick="goHome()">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="homeP" class="page">
    <div class="header" id="userWelcome">Ø§Ù„Ù…ØªØ¬Ø±</div>
    <div style="background: var(--main); color: #000; padding: 8px; border-radius: 8px; margin: 10px 0; text-align: center; font-size: 0.8rem; font-weight: bold;">
        ğŸ”¥ Ø´Ø­Ù† ÙÙˆØ±ÙŠ ÙˆØ£Ø³Ø¹Ø§Ø± Ø®ÙŠØ§Ù„ÙŠØ© ğŸ”¥
    </div>
    <div class="grid" id="itemsCont"></div>
    <footer>forgame202601@gmail.com | +213777392155</footer>
</div>

<div id="prodP" class="page">
    <div onclick="showPage('homeP')" style="color: var(--main); cursor: pointer; font-weight: bold;">â† Ø¹ÙˆØ¯Ø©</div>
    <div style="text-align: center; margin-top: 20px;">
        <h2 id="pTitle"></h2>
        <h3 id="pPrice" style="color: #10b981;"></h3>
        
        <input type="text" id="pData" placeholder="">
        
        <div class="upload-section">
            <label style="font-size: 0.8rem; display: block; margin-bottom: 5px;">ğŸ“¸ Ø§Ø±ÙØ¹ ÙˆØµÙ„ Ø¨Ø±ÙŠØ¯ÙŠ Ù…ÙˆØ¨:</label>
            <input type="file" id="pReceipt" style="font-size: 0.8rem; border: none; background: none;">
        </div>

        <button type="button" class="btn" onclick="finishOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
    </div>
</div>

<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ù„Ù„ØªÙˆ
  const firebaseConfig = {
    apiKey: "AIzaSyBEAp4wDhJ4UDQ-t6MytKZlXUEZQ_MAR_Y",
    authDomain: "market-store-dz-7edf8.firebaseapp.com",
    projectId: "market-store-dz-7edf8",
    storageBucket: "market-store-dz-7edf8.firebasestorage.app",
    messagingSenderId: "218011933887",
    appId: "1:218011933887:web:2116868fde642139acfa0a",
    measurementId: "G-37H0V3KYKB"
  };

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Ø¬Ø¹Ù„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  window.finishOrder = async function() {
      const file = document.getElementById('pReceipt').files[0];
      if(!file) return alert("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙˆØµÙ„ Ø£ÙˆÙ„Ø§Ù‹!");

      try {
          // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø³Ø­Ø§Ø¨Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ†
          const storageRef = ref(storage, 'receipts/' + Date.now() + "_" + file.name);
          await uploadBytes(storageRef, file);
          const photoURL = await getDownloadURL(storageRef);

          // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ (ID Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø£Ùˆ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„) ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          await addDoc(collection(db, "orders"), {
              customer: user,
              product: current.t,
              details: document.getElementById('pData').value,
              receipt: photoURL,
              date: new Date()
          });

          // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
          window.location.href = `https://wa.me/213777392155?text=Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${user}: ${current.t}. Ø§Ù„ÙˆØµÙ„: ${photoURL}`;
      } catch (e) {
          alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ Mode Test ÙÙŠ Firebase");
      }
  };
</script>

    }
</script>
</body>
</html>
